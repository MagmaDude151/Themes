<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MYUI — Modern Theme (Example)</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    /* ---------------------
       Theme variables (easy to tweak)
       --------------------- */
    :root{
      --bg-900: #071026;       /* deep */
      --bg-800: #0c1b2f;       /* surface */
      --panel: rgba(255,255,255,0.03);
      --glass: rgba(255,255,255,0.04);
      --accent: #7c5cff;      /* primary */
      --accent-2: #00e6d7;    /* secondary */
      --muted: #9fb0c8;
      --text: #eaf2ff;
      --shadow: 0 12px 30px rgba(2,6,23,0.6);
      --radius: 14px;
      --tile-w: 200px;
    }

    /* Reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body,#app{height:100%}
    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg-900),var(--bg-800));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:20px;
    }

    /* App frame */
    .frame{
      max-width:1400px;
      margin:0 auto;
      height:calc(100vh - 40px);
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:20px;
    }

    /* Left: big preview panel */
    .panel{
      background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:14px;
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
    }

    .brand{
      display:flex;align-items:center;gap:12px
    }
    .logo{
      width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#02101a;font-size:18px;box-shadow:0 6px 22px rgba(124,92,255,0.18)
    }
    .brand h1{font-size:18px;letter-spacing:0.4px}
    .brand p{font-size:12px;color:var(--muted)}

    .preview-cover{
      width:100%;height:360px;border-radius:12px;overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(2,6,23,0.35), rgba(0,0,0,0.6));
    }
    .preview-cover img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.02) saturate(1.05)}

    .preview-overlay{position:absolute;inset:0;padding:18px;display:flex;flex-direction:column;justify-content:flex-end;gap:10px}

    .meta{
      display:flex;align-items:center;gap:12px
    }
    .meta .title{font-size:20px;font-weight:700}
    .meta .store{font-size:12px;color:var(--muted)}

    .actions{display:flex;gap:12px;align-items:center}
    .btn{
      background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:10px 16px;border-radius:10px;border:none;color:#02101a;font-weight:700;cursor:pointer;box-shadow:0 10px 30px rgba(7,15,40,0.45);
    }
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:9px 14px}

    .meta .rating{margin-left:auto;font-size:12px;color:var(--muted)}

    /* Right: tiles area */
    .tiles-area{display:flex;flex-direction:column;gap:12px}
    .search-row{display:flex;align-items:center;gap:12px}
    .search{
      flex:1;background:var(--panel);padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);display:flex;align-items:center;gap:8px
    }
    .search input{flex:1;background:transparent;border:none;color:var(--text);outline:none;font-size:14px}
    .controls{display:flex;gap:8px}
    .control{background:var(--glass);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);cursor:pointer;font-size:13px}

    .grid-wrap{position:relative;flex:1;overflow:hidden;border-radius:12px}
    .tiles{
      display:grid;grid-template-columns: repeat(auto-fill,minmax(var(--tile-w),1fr));gap:14px;padding:18px;overflow:auto;height:100%;
    }

    .tile{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;aspect-ratio:3/4;display:flex;flex-direction:column;cursor:pointer;transition:transform .22s ease,box-shadow .22s ease;border:1px solid rgba(255,255,255,0.03);
    }
    .tile:focus{outline:none}
    .tile img{width:100%;height:70%;object-fit:cover}
    .tile .info{padding:10px 12px;display:flex;flex-direction:column;gap:6px}
    .tile .name{font-weight:600;font-size:14px}
    .tile .meta{font-size:12px;color:var(--muted)}

    .tile:hover{transform:translateY(-8px);box-shadow:0 30px 60px rgba(2,6,23,0.6)}

    .tile.focused{transform:translateY(-12px) scale(1.02);box-shadow:0 30px 70px rgba(2,6,23,0.75);border:1px solid rgba(124,92,255,0.18)}

    /* Badges */
    .badge{position:absolute;top:14px;left:14px;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:6px 8px;border-radius:8px;font-weight:700;color:#02101a;font-size:12px}

    /* Loading spinner */
    .spinner{width:56px;height:56px;border-radius:50%;border:5px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite;margin:50px auto;display:none}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Dialogs */
    dialog{border:none;border-radius:12px;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.6));color:var(--text)}
    dialog::backdrop{background:rgba(0,0,0,0.6);backdrop-filter:blur(3px)}

    /* Responsive */
    @media (max-width:980px){
      .frame{grid-template-columns: 1fr;grid-auto-rows: auto 1fr}
      .preview-cover{height:260px}
    }
  </style>
</head>
<body>
  <div id="app" class="frame">
    <aside class="panel">
      <div class="brand">
        <div class="logo">MY</div>
        <div>
          <h1>MYUI • Modern</h1>
          <p>One Game Launcher theme — example</p>
        </div>
      </div>

      <div class="preview-cover" id="preview-cover">
        <img id="preview-img" src="" alt="Cover" />
        <div class="badge" id="preview-badge" style="display:none">STORE</div>
        <div class="preview-overlay">
          <div class="meta">
            <div>
              <div class="title" id="preview-title">Select a game</div>
              <div class="store" id="preview-store">Games will appear here</div>
            </div>
            <div class="rating" id="preview-rating"> </div>
          </div>

          <div class="actions">
            <button class="btn" id="launch-btn" disabled>Play</button>
            <button class="btn secondary" id="details-btn" disabled>Details</button>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:8px;align-items:center">
        <div style="flex:1;color:var(--muted);font-size:13px">Tip: Use ← → or A / D to navigate • Enter to launch</div>
        <button class="control" id="settings">Settings</button>
      </div>
    </aside>

    <section class="tiles-area">
      <div class="search-row">
        <div class="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"></circle></svg>
          <input id="search" placeholder="Search games or stores..." />
        </div>
        <div class="controls">
          <div class="control" id="sort">Sort</div>
          <div class="control" id="filter">Filter</div>
        </div>
      </div>

      <div class="grid-wrap">
        <div class="tiles" id="tiles"></div>
        <div class="spinner" id="spinner"></div>
      </div>

    </section>
  </div>

  <dialog id="alert-dialog"><p id="alert-msg">Alert</p><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px"><button id="alert-ok" class="btn small">OK</button></div></dialog>

  <script>
    (()=>{
      const API = 'http://localhost:8080';
      const tilesEl = document.getElementById('tiles');
      const spinner = document.getElementById('spinner');
      const previewImg = document.getElementById('preview-img');
      const previewTitle = document.getElementById('preview-title');
      const previewStore = document.getElementById('preview-store');
      const previewBadge = document.getElementById('preview-badge');
      const launchBtn = document.getElementById('launch-btn');
      const detailsBtn = document.getElementById('details-btn');
      const searchInput = document.getElementById('search');
      const alertDialog = document.getElementById('alert-dialog');
      const alertMsg = document.getElementById('alert-msg');
      const alertOk = document.getElementById('alert-ok');

      let games = [];
      let filtered = [];
      let currentIndex = 0;
      let isLaunching = false;

      function showAlert(msg){
        alertMsg.textContent = msg;
        alertDialog.showModal();
      }
      alertOk.onclick = ()=>alertDialog.close();

      function setLoading(on){
        spinner.style.display = on ? 'block' : 'none';
      }

      function fetchGames(){
        setLoading(true);
        fetch(`${API}/GetAllGames`).then(r=>r.json()).then(list=>{
          games = Array.isArray(list) ? list : [];
          filtered = games.slice();
          renderTiles();
          setLoading(false);
          if(games.length>0) selectIndex(0);
        }).catch(err=>{
          console.error(err);
          setLoading(false);
          showAlert('Could not reach OGL API. Make sure the MYUI API server is running.');
        })
      }

      function renderTiles(){
        tilesEl.innerHTML='';
        filtered.forEach((g,i)=>{
          const tile = document.createElement('button');
          tile.className='tile';
          tile.type='button';
          tile.dataset.index=i;
          tile.innerHTML = `\n            <img src="${g.CoverArtUrl || ''}" alt="${escapeHtml(g.Title)}">\n            <div class="info">\n              <div class="name">${escapeHtml(g.Title)}</div>\n              <div class="meta">${escapeHtml(g.Store || '')}</div>\n            </div>\n          `;

          const img = tile.querySelector('img');
          img.onerror = ()=>{ img.style.display='none'; /* fallback styling could be added */ };

          tile.addEventListener('click', ()=>{
            selectIndex(i);
            launchGame(filtered[i]);
          });

          tile.addEventListener('focus', ()=>{
            selectIndex(i);
          });

          tilesEl.appendChild(tile);
        })
      }

      function selectIndex(idx){
        if(filtered.length===0) return;
        currentIndex = Math.max(0, Math.min(idx, filtered.length-1));
        const all = tilesEl.querySelectorAll('.tile');
        all.forEach((t,ti)=>{
          t.classList.toggle('focused', ti===currentIndex);
        });
        const g = filtered[currentIndex];
        previewTitle.textContent = g.Title || 'Untitled';
        previewStore.textContent = g.Store || '';
        previewBadge.style.display = g.Store ? 'block' : 'none';
        previewBadge.textContent = g.Store || '';
        previewImg.src = g.CoverArtUrl || '';
        launchBtn.disabled = false;
        detailsBtn.disabled = false;
      }

      function launchGame(game){
        if(isLaunching) return;
        isLaunching = true;
        launchBtn.textContent = 'Launching...';
        fetch(`${API}/LaunchGame?Id=${encodeURIComponent(game.Id)}&Store=${encodeURIComponent(game.Store)}`)
          .then(r=>r.text()).then(()=>{
            // attempt to close/minimize the launcher window after start
            fetch(`${API}/CloseOrMinimizeAppWindowAfterGameLaunch`).catch(()=>{});
          }).catch(err=>{
            console.error(err);
            showAlert('Failed launching the game.');
          }).finally(()=>{
            setTimeout(()=>{ isLaunching=false; launchBtn.textContent = 'Play' }, 1600);
          })
      }

      // Search
      searchInput.addEventListener('input', ()=>{
        const q = searchInput.value.trim().toLowerCase();
        if(!q) filtered = games.slice();
        else filtered = games.filter(g=> (g.Title||'').toLowerCase().includes(q) || (g.Store||'').toLowerCase().includes(q));
        renderTiles();
        selectIndex(0);
      });

      // Keyboard navigation
      document.addEventListener('keydown',(e)=>{
        if(['ArrowLeft','a','A'].includes(e.key)){
          selectIndex(Math.max(0,currentIndex-1));
          scrollIntoView(currentIndex);
          e.preventDefault();
        } else if(['ArrowRight','d','D'].includes(e.key)){
          selectIndex(Math.min(filtered.length-1,currentIndex+1));
          scrollIntoView(currentIndex);
          e.preventDefault();
        } else if(e.key==='Enter'){
          const g = filtered[currentIndex]; if(g) launchGame(g);
        }
      });

      // Make sure focused tile is visible within scroll
      function scrollIntoView(idx){
        const node = tilesEl.querySelector(`.tile[data-index="${idx}"]`);
        if(node) node.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
      }

      // Utility: escape HTML
      function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, (c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

      // Initial fetch
      fetchGames();

      // Poll list every 60s (so theme stays in sync if OGL updates)
      setInterval(fetchGames, 60000);

      // Expose debug on window for quick testing
      window.__MYUI = { fetchGames, selectIndex };
    })();
  </script>
</body>
</html>